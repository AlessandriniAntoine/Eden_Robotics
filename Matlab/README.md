# Matlab

Create your simscape model using the urdf file :

```console
simimport(<urdf_path>)
```

Once it is done, you have a simulink file with a simscape model. You should run your file once. Then you can save the variables space that contains you robot. It will be useful for the inverse kinematics simulink block.

Thanks to the different toolbox in matlab we perfom :

- inverse kinematics (inverse kinematics file)
- forward kinematics (robot file)
- closed loop model (closed loop)

The files ForwarKinematics and position only send ros topic using knob. Thanks to that, you can modify easely a topic value to make some test for the forwark kinematics (joint values) or the inverse kinematics (target position).

## ROS

### Connect to ROS

To connect to ROS you will need to configure ROS Network Adress.You can access this in the **Simulation tab** by selecting **ROS Toolbox** > **ROS Network**. You will need to set :

- ROS Master
- Network Adress

To run files that contain ros block, you need a ROS master. You can either, run it on a terminal (recommended) with the following commande :

```console
~ $ source /opt/ros/noetic/setup.bas
~ $ roscore 
```

Or run in matlab terminal a **rosinit** command. Notice that if you do that, you cannot use the same ros master to run node that use not matlab.

### Generate Node

The ros folder contains files that are generated by Matlab to create ros packaga from a simulink file. To generate them you need set parameters. You can access this in the **modeling tab** > **Model Settings** > **Hardware Implementation** > **Hardware board settings** > **Target hardware resources** > **Groups** > **Build Options**. You need to set :

- Device Adress (127.0.0.1 if personnal)
- Username
- password
- Ros folder (already set)
- path to catkin workspace

Then you just have to generate the files. It will create :

- build_ros_model.sh
- <Simulink_file_name>.tgz

You can now create your package with the following command :

```console
~/Matlab_folder $ ./build_ros_model.sh <your_name>.tgz <path to catkin_workspace>
```

## Useful links

- [robotic_system_toolbox_documentation](https://in.mathworks.com/help/robotics/index.html?s_tid=CRUX_lftnav)
- [ros_toolbox_documentation](https://in.mathworks.com/help/ros/index.html?s_tid=CRUX_lftnav)
- [simscape_toolbox_documentation](https://in.mathworks.com/help/simscape/index.html)
- [simulink_documentaton](https://in.mathworks.com/help/simulink/index.html?searchHighlight=simulink&s_tid=srchtitle_simulink_1)
- [generate_node_simulink_tutorial](https://in.mathworks.com/help/ros/ug/generate-a-standalone-ros-node-from-simulink.html)
