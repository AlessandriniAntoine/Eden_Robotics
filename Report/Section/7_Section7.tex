\section{ROS}\insertloftspace
\setcounter{figure}{0}\setcounter{table}{0}

For our project, we used ros1 noetic.

\subsection{Definition}

\hspace{\parindent} As the name suggests, ROS (Robot Operating System) is an operating system for robots. Like operating systems for PCs, servers or stand-alone devices, ROS is a complete operating system for service robotics.

\bigbreak
It is composed of a set of free open source software allowing to develop software for robotics. ROS is a meta operating system, something between the operating system and the middleware.

\bigbreak
ROS is therefore positioned as a facilitator of robotics projects. Researchers or engineers in R\&D departments no longer spend time creating a new ecosystem for each new robotics project. ROS has an accelerating effect on R\&D by reducing costs and time to market. It is therefore very interesting for the rapid development of a prototype

\bigbreak
\textbf{Master:} The master is a ROS process that helps nodes locate each other and establish communication channels based on their publisher subscriber relationships and any services. The master also manages the parameter server. The master is typically started through the roscore command-line tool, or it is automatically started via a roslaunch call.

\bigbreak
\textbf{Topic:} A topic is a many-to-many information transport system. It is typed, it is necessary to specify which type of messages we transport and based on the system of subscription / publication 

\bigbreak
\textbf{Node:} A node is an instance of an executable; it can be linked to an engine, a sensor, or purely software. A node can post messages to a topic or subscribe to messages in a topic. They are independent processes, the crash of a node does not crash the whole ROS (Notion of micro-kernel on which ROS is based)

\bigbreak
\textbf{Launch file:} Launch files are very common in ROS to both users and developers. They provide a convenient way to start up multiple nodes and a master, as well as other initialization requirements such as setting parameters.

\bigbreak
\textbf{Package:} A collection of source code, configuration files, and other resources that implements functionality in ROS. By dividing related functionality into packages, it can be shared with others and reused across projects. All packages must have a package.xml file defining its manifest.

\bigbreak
\textbf{Workspace:} A workspace is a folder where you modify, build, and install packages.

\subsection{Training}

\subsection{Nodes}
\hspace{\parindent} To start a node, you have to source ROS, source the workspace that contains the package if this has not been done in the terminal and then launch the node.
\begin{commandshell}
    source /opt/ros/noetic/setup.bash
    roscore
    rosrun <package_name> <node_name>
\end{commandshell}

\subsubsection{Forward kinematics}

\subsubsection{Inverse kinematics}

\hspace{\parindent} The inverse kinematics node was created from simulink. The python model did not provide any results, so it was easier to use the code generator of matlab.

\bigbreak
The node subscribes to the topic \textit{\textbackslash Robot\textbackslash ref\textbackslash position} and publish the topic \textit{\textbackslash Robot\textbackslash ref\textbackslash joint}. The input topic is of type Point, it publishes the x,y,z coordinates of the desired position. The output topic is of type JointState, from the sensor\_msgs library, it publishes a list containing the position of each link as well as an other one with their names and a header indicating the time.
\bigbreak
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.8\textwidth]{images/Section07/Inverse\_kinematics\_node.png}
    \caption{Inverse kinematics node}
    \label{fig:mesh21}
\end{figure}
\FloatBarrier

\bigbreak
To connect to ROS with Matlab you will need to configure ROS Network Adress.You can access this in the \textbf{Simulation tab} by selecting \textbf{ROS Toolbox} $\bg$ \textbf{ROS Network}. You will need to set :
\begin{multicols}{2}
    \begin{itemize}[noitemsep]
        \item ROS Master
        \item Network Adress
    \end{itemize}
\end{multicols}

\bigbreak
To run files that contain ros block, you need a ROS master. You can run it on a terminal with the following commande :
\begin{commandshell}
    source /opt/ros/noetic/setup.bash
    roscore
\end{commandshell} 

\bigbreak
The ros folder contains files that are generated by Matlab to create ros packaga from a simulink file. To generate them you need set parameters. You can access this in the \textbf{modeling tab} $\bg$ \textbf{Model Settings} $\bg$ \textbf{Hardware Implementation} $\bg$ \textbf{Hardware board settings} $\bg$ \textbf{Target hardware resources} $\bg$ \textbf{Groups} $\bg$ \textbf{Build Options}. You need to set :
\begin{itemize}[noitemsep]
    \item Device Adress (127.0.0.1 if localhost)
    \item Username
    \item password
    \item Ros folder (already set)
    \item path to catkin workspace
\end{itemize}

\bigbreak
Then you just have to generate the files. It will create :
\begin{multicols}{2}
    \begin{itemize}[noitemsep]
        \item build\_ros\_model.sh
        \item $\less$model\_name$\bg$.tgz
    \end{itemize}
\end{multicols}


\bigbreak
From the folder where are the files, you can now create your package with the following command. The package and the node will have the same name as the simulink model.
\begin{commandshell}
    ./build_ros_model.sh <model>.tgz <catkin_workspace_path>
\end{commandshell} 



\subsubsection{Change frame}

\subsubsection{Motors}

\subsubsection{Camera}

\subsection{Launch files}
\subsubsection{Rviz}

\subsubsection{Inverse kinematics}

\subsubsection{Open loop}

\subsubsection{Closed loop}